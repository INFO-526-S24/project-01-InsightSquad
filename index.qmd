---
title: "Childcare Cost Analysis"
subtitle: "INFO 526 - Project 1"
author:
  - name: "**Team InsightSquad** - Mohammad Farmani, Narasimha Vardhan Rachaputi, Amaan"
  - name: ",Devendran, Shreemithra, Gowtham"
format: html
editor: visual
execute:
  echo: false
  message: false
  error: false
---

```{r}
#| label: load-packages
#| include: false

# Load packages here
pacman::p_load(tidymodels,
               tidyverse,
               dplyr,
               ggplot2,
               here,
               tidyr,
               stats,
               usmap,
               ggpointdensity,
               viridis,
               ggpubr
               
               )

devtools::install_github("UrbanInstitute/urbnmapr")
library(urbnmapr)
```

```{r}

#| label: setup
#| include: false

# Plot theme
ggplot2::theme_set(ggplot2::theme_minimal(base_size = 11))

# For better figure resolution
knitr::opts_chunk$set(
  fig.retina = 3, 
  dpi = 300, 
  fig.width = 6, 
  fig.asp = 0.618 
  )
child_cost <- read.csv(here('Data','childcare_costs.csv'))
counties <- read.csv(here('Data','counties.csv'))

counties_data <- counties
childcare_data <- child_cost

```

## Abstract

The project investigates the intricate dynamics between childcare costs, unemployment rates, and poverty levels across various regions in the United States. Utilizing two primary datasets—the National Database of Childcare Prices (NDCP) and a comprehensive Counties Dataset—the analysis employs spatial mapping techniques to visualize mean unemployment rates and family poverty rates, as well as correlations between unemployment rates and poverty levels at the county and state levels. The findings reveal significant regional variations in unemployment rates, highlighting gender disparities, and underscore the correlation between unemployment rates and poverty levels. Furthermore, the project identifies regions with elevated family poverty rates and explores the relationship between family poverty rates and cumulative childcare costs. The results emphasize the economic challenges faced by families, especially in areas where childcare expenses intersect with high poverty rates. The project concludes with insights into future trends and the potential for integrating predictive modeling techniques and qualitative research methods to inform more effective policy interventions aimed at supporting families across the nation.

## Introduction

The United States faces persistent challenges related to childcare affordability, unemployment rates, and poverty levels, which have profound implications for family well-being and economic stability. Understanding the complex interplay between these factors is crucial for policymakers, researchers, and practitioners seeking to develop effective interventions to support families and communities.

This project aims to investigate the multifaceted relationship between childcare costs, unemployment rates, and poverty levels across diverse regions in the United States. Two primary datasets are utilized: the National Database of Childcare Prices (NDCP), providing comprehensive childcare price data spanning from 2008 to 2018, and a Counties Dataset offering geographical and demographic insights.

The analysis approach involves utilizing spatial mapping techniques to visualize mean unemployment rates, family poverty rates, and correlations between unemployment rates and poverty levels at both the county and state levels. By leveraging these datasets and visualization methods, the project seeks to uncover regional disparities in unemployment rates, gender discrepancies, and the economic burden faced by families due to childcare expenses.

The insights generated from this investigation have the potential to inform policymakers, researchers, and stakeholders about the socio-economic challenges faced by families across different regions of the United States. By understanding these dynamics, policymakers can develop targeted interventions to alleviate economic hardships and promote greater equity and prosperity for families nationwide.

## Questions

### Question 1: Which locations have lower unemployment rates? Which gender experiences higher unemployment rates in the US? Is there a relationship between the unemployment rate and poverty?

#### Introduction

This section outlines our methodology for investigating the relationships between unemployment rates, poverty levels, and childcare costs across the United States. By examining these variables, we aim to identify patterns that could have significant implications for social policy and economic support systems.

#### Approach

-   We will focus on the distribution of unemployment rates across genders and its relationship with poverty. The methodology includes creating spatial maps to visualize mean unemployment rates (overall, and by gender) across the US. We will then calculate the correlation between the overall unemployment rate and individual poverty levels at the state level, producing spatial maps to display these correlations.
-   For "Which locations have lower unemployment rates?", we will use the "unr_16" variable and the state IDs to plot the spatial map of the overall unemployment rate. We first average the mentioned variable over time, and then the averaged unemployment rate will be used to plot the spatial map.
-   For the second part, specifically gender-related, the "munr_16" and "funr_16" variables, as well as state location IDs, will be used to plot the unemployment rates for men and women, respectively. We first average the mentioned variables over time, and then the averaged unemployment rates will be used to plot the spatial map.
-   To quantify the relationship between the unemployment rate and poverty, the correlation between individual poverty, "pr_p", and overall unemployment, "unr_16", will be calculated for each state, and a spatial map will be plotted.

#### Analysis

```{r}
# Calculate average unemployment
averaged_unemployment <- child_cost %>%
  group_by(county_fips_code) %>%
  summarise(mean_unr_16 = mean(unr_16, na.rm = TRUE))

# Merge the unemployment data with county details to use for our geo_data(The main dataset)
geo_data <- counties %>%
  select(county_fips_code, state_abbreviation) %>%
  left_join(averaged_unemployment, by = "county_fips_code")


# Calculate the average unemployment rate at the state level for usmaps
state_unemployment <- geo_data %>%
  group_by(state_abbreviation) %>%
  summarise(mean_unr_state = mean(mean_unr_16, na.rm = TRUE))


# Rename 'state_abbreviation' to 'state' for compatibility with usmap
state_unemployment <- state_unemployment %>%
  rename(state = state_abbreviation)

# Plot the state-level map
plot_usmap(data = state_unemployment, values = "mean_unr_state", regions = "states") +
  scale_fill_continuous(name = "Avg State Unemployment",low = "lightblue", high = "navy", na.value = "lightblue") +
  labs(title = "Average Unemployment Rate by State",
       subtitle = "Based on Data from Childcare Costs") +
  theme_minimal() +
  theme(legend.position = "bottom",
        plot.title = element_text(hjust = 0.5, size = 16),
        plot.subtitle = element_text(hjust = 0.5, size = 12),
        legend.title = element_text(size = 12),
        legend.text = element_text(size = 10),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        panel.background = element_rect(fill = "white", colour = NA),
        plot.background = element_rect(fill = "white", colour = NA),
        axis.ticks = element_blank(), 
        axis.title.x = element_blank(), 
        axis.title.y = element_blank())
```

```{r}
# gender specific unemployment 
averaged_gender_unemployment <- child_cost %>%
  group_by(county_fips_code) %>%
  summarise(
    avg_unr_16_m = mean(munr_16, na.rm = TRUE),  #  for Male
    avg_unr_16_f = mean(funr_16, na.rm = TRUE)   # for Female
  )
# Merging 
geo_data_gender <- counties %>%
  select(county_fips_code, state_abbreviation) %>%
  left_join(averaged_gender_unemployment, by = "county_fips_code") %>%
  mutate(fips = as.character(county_fips_code))  # Prepare for usmap

# state level for gender-specific rates similar to overll maps part 2
state_unemployment_gender <- geo_data_gender %>%
  group_by(state_abbreviation) %>%
  summarise(
    avg_unr_state_m = mean(avg_unr_16_m, na.rm = TRUE),  # Male
    avg_unr_state_f = mean(avg_unr_16_f, na.rm = TRUE)   # Female
  ) %>%
  rename(state = state_abbreviation)  # Ensuring compatibility with usmap

# plot state-level map for gender-specific unemployment rates
plot_state_unemployment_rate <- function(data, value_col, title) {
  plot_usmap(data = data, values = value_col, regions = "states") +
    scale_fill_continuous(name = title, low = "lightblue", high = "navy", na.value = "lightblue") +
    labs(title = title,
         subtitle = "Gender-specific unemployment rates in US") +
    theme_void() +
    theme(legend.position = "bottom",
          plot.title = element_text(hjust = 0.5, size = 14),
          plot.subtitle = element_text(hjust = 0.5, size = 10),
          legend.title = element_text(size = 10),
          legend.text = element_text(size = 8),
          panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        panel.background = element_rect(fill = "white", colour = NA),
        plot.background = element_rect(fill = "white", colour = NA),
        axis.ticks = element_blank(), 
        axis.title.x = element_blank(), 
        axis.title.y = element_blank())
}

# Plotting for male and female unemployment rates


male_map <- plot_state_unemployment_rate(state_unemployment_gender, "avg_unr_state_m", "Average Male Unemployment Rate by State")
female_map <- plot_state_unemployment_rate(state_unemployment_gender, "avg_unr_state_f", "Average Female Unemployment Rate by State")

print(male_map)
print(female_map)
```

#### 

::: columns
::: {.column width="50%"}
```{r, message=FALSE, warning=FALSE}
male_map <- plot_state_unemployment_rate(state_unemployment_gender, "avg_unr_state_m", "Average Male Unemployment Rate by State")
print(male_map)
```
:::

::: {.column width="50%"}
```{r, message=FALSE, warning=FALSE}
female_map <- plot_state_unemployment_rate(state_unemployment_gender, "avg_unr_state_f", "Average Female Unemployment Rate by State")
print(female_map)
```
:::
:::

## 

```{r}
#| label: COR

CHLD <- read_csv(here('data','childcare_costs.csv'))
conty <- read_csv(here('data','counties.csv'))

combine <- merge(CHLD,conty,by=c('county_fips_code'),all.x=T)
combine <- combine|>filter(!state_name%in%c("Hawaii"))

ggplot(combine,aes(x = pr_p, y = unr_16)) + 
  geom_point() +
  geom_pointdensity() +
  geom_abline (slope=1, linetype = "dashed", color="Red") +
  scale_color_viridis() +
  labs(title = "Family Poverty vs Unemployment Rate",
       subtitle = "Considering all the States",
       x = 'Family Poverty(%)',
       y= 'Unemployment Rate (%)',
       color = "Density\n"
       ) +
  stat_cor(method = "pearson", label.x = 3, label.y = 30)


```

The plot suggests a positive correlation, indicated by the correlation coefficient R of 0.6 and a highly significant p-value (\<2.2×10−16), meaning there's a statistically significant relationship between higher levels of poverty and higher unemployment rates. The density of the points is visualized by color intensity, with the most densely populated area being where family poverty and unemployment rates are relatively low.

```{r}
#| label: COR_SOATIAL
child_cost <- read.csv(here('Data','childcare_costs.csv'))
counties <- read.csv(here('Data','counties.csv'))

# Calculate average unemployment
averaged_unemployment <- child_cost %>%
  group_by(county_fips_code) %>%
  summarise(mean_unr_16 = mean(unr_16, na.rm = TRUE))


child_cost <- read.csv(here('Data','childcare_costs.csv'))
counties <- read.csv(here('Data','counties.csv'))

correlation_data <- combine %>%
  group_by(county_fips_code) %>%
  summarize(correlation = cor(pr_p, unr_16))




geo_data <- counties %>%
  select(county_fips_code, state_abbreviation) %>%
  left_join(correlation_data, by = "county_fips_code")

state_correlation <- geo_data %>%
  group_by(state_abbreviation) %>%
  summarise(mean_cor_state = mean(correlation, na.rm = TRUE))

# Rename 'state_abbreviation' to 'state' for compatibility with usmap
state_correlation <- state_correlation %>%
  rename(state = state_abbreviation)

# Plot the state-level map
state_map <- plot_usmap(data = state_correlation, values = "mean_cor_state", regions = "states") +
  scale_fill_continuous(name = "Correlation", low = "green", high = "red", na.value = "grey50") +
  labs(title = "Average Correlation Rate by State",
       subtitle = "Based on 'pr_p' and 'unr_16 variables from Childcare Costs Dataset") +
  theme_minimal() +
  theme(legend.position = "right",
        plot.title = element_text(hjust = 0.5, size = 16),
        plot.subtitle = element_text(hjust = 0.5, size = 12),
        legend.title = element_text(size = 12),
        legend.text = element_text(size = 10))

# Display the state-level map
print(state_map)
```

The spatial map highlights a distinct geographical pattern where the western, southwestern, and southeastern regions of the United States exhibit higher correlation rates between the 'pr_p' and 'unr_16' variables from a Childcare Costs Dataset. This elevated correlation suggests a more robust relationship between these variables in those particular regions. Essentially, the map could be interpreted to suggest that in areas where unemployment is more prevalent, the associated costs of childcare (if 'pr_p' and 'unr_16' are indeed related to such costs) might be more closely linked to economic hardship, thus leading to an increase in family poverty levels. The underlying social and economic dynamics could be complex, with unemployment affecting a family's income and subsequently their ability to afford essential services like childcare, which then contributes to a cycle of poverty.

#### Discussion

### Question 2: Which places have higher rates of family poverty? Is there a relationship between poverty and the cost of raising children?

#### Introduction

This section outlines our methodology for investigating the relationships between unemployment rates, poverty levels, and childcare costs across the United States. By examining these variables, we aim to identify patterns that could have significant implications for social policy and economic support systems.

#### Approach

-   The emphasis will be on understanding the dynamics between family poverty rates and the financial burden of childcare. This part involves generating spatial maps to illustrate the average rate of family poverty across the US. Subsequently, we will assess the correlation between family poverty rates and the cumulative childcare costs (encompassing both Family Childcare and Center-based Care) for all age groups at the state level, with spatial maps visualizing these correlations.
-   To illustrate the family poverty over US, the average of family poverty variable, pr_f, will be computed over the available time period, and then, the poverty of families will be plotted using the state IDs. Moreover, to demonstrate the relation between family poverty and children expenses, the sum of children costs , mc_infant, mc_toddler, mc_preschool, mfcc_infant, mfcc_toddler, and mfcc_preschool, will be calculated and the correlation between sum_of_children_costs and families' poverty will be computed and plotted.

#### Analysis

::: columns
::: {.column width="50%"}
```{r}
# Calculate average family poverty rate at county level
average_poverty_county <- childcare_data %>%
  group_by(county_fips_code) %>%
  summarise(avg_pr_f = mean(pr_f, na.rm = TRUE)) %>%
  mutate(county_fips_code = as.character(county_fips_code))

# Merge with US counties map
counties_map <- get_urbn_map("counties")

merged_data_county <- left_join(counties_map, average_poverty_county, by = c("county_fips" = "county_fips_code"))
```
```{r, message=FALSE, warning=FALSE, echo=TRUE}
# Calculate average family poverty rate at county level
average_poverty_county <- childcare_data %>%
  group_by(county_fips_code) %>%
  summarise(avg_pr_f = mean(pr_f, na.rm = TRUE)) %>%
  mutate(county_fips_code = as.character(county_fips_code))

# Merge with US counties map
counties_map <- get_urbn_map("counties")

merged_data_county <- left_join(counties_map, average_poverty_county, by = c("county_fips" = "county_fips_code"))

# Calculate average family poverty rate at state level
average_poverty_state <- merged_data_county %>%
  group_by(state_name) %>%
  summarise(avg_pr_f_state = mean(avg_pr_f, na.rm = TRUE))
```
:::

::: {.column width="50%"}
```{r, warning=FALSE, fig.width=5.5}

states_map <- get_urbn_map("states", sf = TRUE)
merged_data_state <- left_join(states_map, average_poverty_state, by = c("state_name" = "state_name"))

ggplot(data = merged_data_state, aes(fill = avg_pr_f_state, color = state_name)) +
  geom_sf(size = 0.2) +
  geom_sf_text(aes(label = state_name), size = 3, check_overlap = TRUE) +
  scale_fill_gradient(low = "lightblue", high = "darkblue",na.value = "#767abe", name = "Avg Family Poverty Rate") +  # Custom color scale
  labs(title = "Average Family Poverty Rate by State", subtitle = "Differentiated by State") +
  theme_minimal() +
  theme(axis.text = element_blank(), axis.title = element_blank()) +
  guides(color = FALSE) 

```
:::
:::

## 

```{r}
childcare_data <- childcare_data %>%
  mutate(cumulative_childcare_costs = mc_infant + mc_toddler + mc_preschool + mfcc_infant + mfcc_toddler + mfcc_preschool)

merged_childcare_data <- left_join(childcare_data, counties_data, by = "county_fips_code")


# Calculate average cumulative childcare costs at the state level
average_childcare_costs_state <- merged_childcare_data %>%
  group_by(state_name) %>%
  summarise(avg_childcare_costs_state = mean(cumulative_childcare_costs, na.rm = TRUE)) 

# Get US states map
states_map <- get_urbn_map("states", sf = TRUE)

# Merge data for visualization
merged_data_childcare_costs_state <- left_join(states_map, average_childcare_costs_state, by = c("state_name" = "state_name"))


ggplot(data = merged_data_childcare_costs_state, aes(fill = avg_childcare_costs_state, color = state_name)) +
  geom_sf(size = 0.2) +
  geom_sf_text(aes(label = state_name), size = 3, check_overlap = TRUE) +
  scale_fill_gradient(low = "lightgreen", high = "yellow", na.value="#d0f75e", name = "Avg Childcare Costs") +  # Custom color scale
  labs(title = "Average Cumulative Childcare Costs by State", subtitle = "Differentiated by State") +
  theme_minimal() +
  theme(axis.text = element_blank(), axis.title = element_blank()) +
  guides(color = FALSE)

```

## 

```{r}

# 3rd graph
averaged_unemployment <- averaged_unemployment %>%
  left_join(counties_data %>% select(county_fips_code, state_name), by = "county_fips_code")

averaged_unemployment_state <- averaged_unemployment %>%
  group_by(state_name) %>%
  summarise(mean_unemployment = mean(mean_unr_16, na.rm = TRUE))


merged_data <- inner_join(averaged_unemployment_state, average_childcare_costs_state, by = "state_name")

# Create the correlation graph
ggplot(merged_data, aes(x = mean_unemployment, y = avg_childcare_costs_state)) +
  geom_jitter(alpha = 0.5, width = 0.2, height = 0.2) +  # Adjust alpha for transparency
  # geom_smooth(method = "lm", color = "blue") +
  labs(x = "Average Unemployment Rate (%)", 
       y = "Average Childcare Costs (USD)", 
       title = "Relationship between Unemployment Rate and Childcare Costs") +
  theme_minimal()
  
```

##  {.smaller}

#### Discussion

The proposed analysis plan is designed to dissect the intricate web of economic factors influencing family well-being and child-rearing costs. By delving into the spatial and statistical relationships between unemployment, poverty, and childcare expenses, we anticipate uncovering regional disparities and potential areas for policy intervention. The findings from this analysis could provide a robust evidence base for developing targeted strategies to alleviate the economic pressures on families, particularly in regions where the burden of childcare costs significantly intersects with high unemployment and poverty rates. Through this investigation, we aim to contribute to the broader dialogue on enhancing economic security and access to quality childcare, thereby supporting the well-being of families across the United States.

---
title: "Childcare Costs, Unemployment, and Poverty Dynamics in the US"
subtitle: "INFO 526 - Spring 2024 - Project 1"

author: "Narasimha ,Devendran ,Mohammad ,Shreemithra , Amaan ,Gawtham --Insight Squad"

title-slide-attributes:
  data-background-image: images/bg.webp
  data-background-size: stretch
  data-background-opacity: "0.5"
  data-slide-number: none
format:
  revealjs:
    theme:  ['data/customtheming.scss']
    transition: slide
    background-transition: fade
  
editor: visual
execute:
  echo: false
---

```{r}
#| label: load-packages
#| include: false

# Load packages here
pacman::p_load(tidymodels,
               tidyverse,
               dplyr,
               ggplot2,
               here,
               tidyr,
               stats,
               usmap,
               ggpointdensity,
               viridis,
               ggpubr
               
               )

devtools::install_github("UrbanInstitute/urbnmapr")
library(urbnmapr)

```

```{r}
#| label: setup
#| include: false

# Plot theme
ggplot2::theme_set(ggplot2::theme_minimal(base_size = 11))

# For better figure resolution
knitr::opts_chunk$set(
  fig.retina = 3, 
  dpi = 300, 
  fig.width = 6, 
  fig.asp = 0.618 
  )
```

```{r}
#| label: load-data
#| include: false
# Load data here

child_cost <- read.csv(here('Data','childcare_costs.csv'))
counties <- read.csv(here('Data','counties.csv'))

counties_data <- counties
childcare_data <- child_cost

```

## INTRODUCTION

::: incremental
-   The objective of this project is to investigate the complex dynamics between childcare costs, unemployment rates, and poverty levels across various locations in the United States.
-   Two main datasets are utilized: the National Database of Childcare Prices (NDCP) and a comprehensive -Counties Dataset.
-   The NDCP dataset spans from 2008 to 2018, providing childcare price data categorized by provider type, age of children, and county characteristics.
-   The Counties Dataset offers geographical and demographic insights, including unemployment rates, poverty rates, and median childcare costs for different age groups.
:::



## QUESTION 1

Which locations have lower unemployment rates? Which gender experiences higher unemployment rates in the US? Is there a relationship between the unemployment rate and poverty?

## APPROACH

::: nonincremental
- Our analysis approach involves creating spatial maps to visualize mean unemployment rates across the US for both genders.  
- We also calculate the correlation between overall unemployment rates and individual poverty levels at the state level.  
- Spatial maps are chosen to provide a clear visual representation of regional disparities in unemployment rates and their relationship with poverty.
:::

## Plots of Question 1

```{r}
# Calculate average unemployment
averaged_unemployment <- child_cost %>%
  group_by(county_fips_code) %>%
  summarise(mean_unr_16 = mean(unr_16, na.rm = TRUE))

# Merge the unemployment data with county details to use for our geo_data(The main dataset)
geo_data <- counties %>%
  select(county_fips_code, state_abbreviation) %>%
  left_join(averaged_unemployment, by = "county_fips_code")


# Calculate the average unemployment rate at the state level for usmaps
state_unemployment <- geo_data %>%
  group_by(state_abbreviation) %>%
  summarise(mean_unr_state = mean(mean_unr_16, na.rm = TRUE))


# Rename 'state_abbreviation' to 'state' for compatibility with usmap
state_unemployment <- state_unemployment %>%
  rename(state = state_abbreviation)

# Plot the state-level map
plot_usmap(data = state_unemployment, values = "mean_unr_state", regions = "states") +
  scale_fill_continuous(name = "Avg State Unemployment",low = "#8ca977", high = "#e4a663", na.value = "#8ca977") +
  labs(title = "Average Unemployment Rate by State",
       subtitle = "Based on Data from Childcare Costs") +
  theme_minimal() +
  theme(legend.position = "bottom",
        plot.title = element_text(hjust = 0.5, size = 16),
        plot.subtitle = element_text(hjust = 0.5, size = 12),
        legend.title = element_text(size = 12),
        legend.text = element_text(size = 10),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        panel.background = element_rect(fill = "white", colour = NA),
        plot.background = element_rect(fill = "white", colour = NA),
        axis.ticks = element_blank(), 
        axis.title.x = element_blank(), 
        axis.title.y = element_blank())

```

## Plot 2

```{r}
# gender specific unemployment 
averaged_gender_unemployment <- child_cost %>%
  group_by(county_fips_code) %>%
  summarise(
    avg_unr_16_m = mean(munr_16, na.rm = TRUE),  #  for Male
    avg_unr_16_f = mean(funr_16, na.rm = TRUE)   # for Female
  )
# Merging 
geo_data_gender <- counties %>%
  select(county_fips_code, state_abbreviation) %>%
  left_join(averaged_gender_unemployment, by = "county_fips_code") %>%
  mutate(fips = as.character(county_fips_code))  # Prepare for usmap

# state level for gender-specific rates similar to overll maps part 2
state_unemployment_gender <- geo_data_gender %>%
  group_by(state_abbreviation) %>%
  summarise(
    avg_unr_state_m = mean(avg_unr_16_m, na.rm = TRUE),  # Male
    avg_unr_state_f = mean(avg_unr_16_f, na.rm = TRUE)   # Female
  ) %>%
  rename(state = state_abbreviation)  # Ensuring compatibility with usmap

# plot state-level map for gender-specific unemployment rates
plot_state_unemployment_rate <- function(data, value_col, title) {
  plot_usmap(data = data, values = value_col, regions = "states") +
    scale_fill_continuous(name = title, low = "#8ca977", high = "#e4a663", na.value = "#8ca977") +
    labs(title = title,
         subtitle = "Gender-specific unemployment rates in US") +
    theme_void() +
    theme(legend.position = "bottom",
          plot.title = element_text(hjust = 0.5, size = 14),
          plot.subtitle = element_text(hjust = 0.5, size = 10),
          legend.title = element_text(size = 10),
          legend.text = element_text(size = 8),
          panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        panel.background = element_rect(fill = "white", colour = NA),
        plot.background = element_rect(fill = "white", colour = NA),
        axis.ticks = element_blank(), 
        axis.title.x = element_blank(), 
        axis.title.y = element_blank())
}

# Plotting for male and female unemployment rates


male_map <- plot_state_unemployment_rate(state_unemployment_gender, "avg_unr_state_m", "Average Male Unemployment Rate by State")
female_map <- plot_state_unemployment_rate(state_unemployment_gender, "avg_unr_state_f", "Average Female Unemployment Rate by State")

print(male_map)
```

## Plot 3

```{r}

print(female_map)

```

## Scatter Plot

```{r}
#| label: COR

CHLD <- read_csv(here('data','childcare_costs.csv'))
conty <- read_csv(here('data','counties.csv'))

combine <- merge(CHLD,conty,by=c('county_fips_code'),all.x=T)
combine <- combine|>filter(!state_name%in%c("Hawaii"))

ggplot(combine,aes(x = pr_p, y = unr_16)) + 
  geom_point() +
  geom_pointdensity() +
  geom_abline (slope=1, linetype = "dashed", color="Red") +
  scale_color_viridis() +
  labs(title = "Family Poverty vs Unemployment Rate",
       subtitle = "Considering all the counties",
       x = 'Family Poverty(%)',
       y= 'Unemployment Rate (%)',
       color = "Density\n"
       ) +
  stat_cor(method = "pearson", label.x = 3, label.y = 30)

```

## Correlation Map

```{r}

child_cost <- read.csv(here('Data','childcare_costs.csv'))
counties <- read.csv(here('Data','counties.csv'))

# Calculate average unemployment
averaged_unemployment <- child_cost %>%
  group_by(county_fips_code) %>%
  summarise(mean_unr_16 = mean(unr_16, na.rm = TRUE))


child_cost <- read.csv(here('Data','childcare_costs.csv'))
counties <- read.csv(here('Data','counties.csv'))

correlation_data <- combine %>%
  group_by(county_fips_code) %>%
  summarize(correlation = cor(pr_p, unr_16))




geo_data <- counties %>%
  select(county_fips_code, state_abbreviation) %>%
  left_join(correlation_data, by = "county_fips_code")

state_correlation <- geo_data %>%
  group_by(state_abbreviation) %>%
  summarise(mean_cor_state = mean(correlation, na.rm = TRUE))

# Rename 'state_abbreviation' to 'state' for compatibility with usmap
state_correlation <- state_correlation %>%
  rename(state = state_abbreviation)

# Plot the state-level map
state_map <- plot_usmap(data = state_correlation, values = "mean_cor_state", regions = "states") +
  scale_fill_continuous(name = "Correlation", low = "green", high = "red", na.value = "grey50") +
  labs(title = "Average Correlation Rate by State",
       subtitle = "Based on 'pr_p' and 'unr_16 variables from Childcare Costs Dataset") +
  theme_minimal() +
  theme(legend.position = "right",
        plot.title = element_text(hjust = 0.5, size = 16),
        plot.subtitle = element_text(hjust = 0.5, size = 12),
        legend.title = element_text(size = 12),
        legend.text = element_text(size = 10))

# Display the state-level map
print(state_map)

```

## Question 2

Which places have higher rates of family poverty? Is there a relationship between poverty and the cost of raising children?

## Approach for Question 2

-   Analyzing the link between family poverty rates and childcare costs.
-   Creating spatial maps to show average family poverty rates across the US.
-   Examining state-level correlations between poverty rates and childcare costs, visualized through spatial maps.

## Plots of Question 2


```{r}
# Calculate average family poverty rate at county level
average_poverty_county <- childcare_data %>%
  group_by(county_fips_code) %>%
  summarise(avg_pr_f = mean(pr_f, na.rm = TRUE)) %>%
  mutate(county_fips_code = as.character(county_fips_code))

# Merge with US counties map
counties_map <- get_urbn_map("counties")

merged_data_county <- left_join(counties_map, average_poverty_county, by = c("county_fips" = "county_fips_code"))
```
```{r, message=FALSE, warning=FALSE, echo=TRUE}
# Calculate average family poverty rate at state level
average_poverty_state <- merged_data_county %>%
  group_by(state_name) %>%
  summarise(avg_pr_f_state = mean(avg_pr_f, na.rm = TRUE))
```

```{r, warning=FALSE, fig.width=5.5}

states_map <- get_urbn_map("states", sf = TRUE)
merged_data_state <- left_join(states_map, average_poverty_state, by = c("state_name" = "state_name"))

ggplot(data = merged_data_state, aes(fill = avg_pr_f_state, color = state_name)) +
  geom_sf(size = 0.2) +
  geom_sf_text(aes(label = state_name), size = 3, check_overlap = TRUE) +
  scale_fill_gradient(low = "lightblue", high = "darkblue",na.value = "#767abe", name = "Avg Family Poverty Rate") +  # Custom color scale
  labs(title = "Average Family Poverty Rate by State", subtitle = "Differentiated by State") +
  theme_minimal() +
  theme(axis.text = element_blank(), axis.title = element_blank()) +
  guides(color = FALSE) 
 

```

## Plot 2

```{r}
childcare_data <- childcare_data %>%
  mutate(cumulative_childcare_costs = mc_infant + mc_toddler + mc_preschool + mfcc_infant + mfcc_toddler + mfcc_preschool)

merged_childcare_data <- left_join(childcare_data, counties_data, by = "county_fips_code")


# Calculate average cumulative childcare costs at the state level
average_childcare_costs_state <- merged_childcare_data %>%
  group_by(state_name) %>%
  summarise(avg_childcare_costs_state = mean(cumulative_childcare_costs, na.rm = TRUE)) 

# Get US states map
states_map <- get_urbn_map("states", sf = TRUE)

# Merge data for visualization
merged_data_childcare_costs_state <- left_join(states_map, average_childcare_costs_state, by = c("state_name" = "state_name"))


ggplot(data = merged_data_childcare_costs_state, aes(fill = avg_childcare_costs_state, color = state_name)) +
  geom_sf(size = 0.2) +
  geom_sf_text(aes(label = state_name), size = 3, check_overlap = TRUE) +
  scale_fill_gradient(low = "lightgreen", high = "yellow", na.value="#d0f75e", name = "Avg Childcare Costs") +  # Custom color scale
  labs(title = "Average Cumulative Childcare Costs by State", subtitle = "Differentiated by State") +
  theme_minimal() +
  theme(axis.text = element_blank(), axis.title = element_blank()) +
  guides(color = FALSE)

```

## Plot 3

```{r}

# 3rd graph

# correlation_data <- merge(average_poverty_state, average_childcare_costs_state, by = "state_name")

# states_map <- get_urbn_map("states", sf = TRUE)

# # Merged data
# merged_data_correlation <- left_join(states_map, correlation_data, by = c("state_name" = "state_name"))

# ggplot(data = merged_data_correlation, aes(fill = avg_pr_f_state, color = avg_childcare_costs_state)) +
#   geom_sf(size = 0.2) +
#   geom_sf_text(aes(label = state_name), size = 3, check_overlap = TRUE)+
#   scale_fill_viridis_c() +
#   labs(title = "Correlation between Family Poverty Rate\nand Childcare Costs by State") +
#   theme_minimal()

# Assuming counties_data contains both county_fips_code and state_name
averaged_unemployment <- averaged_unemployment %>%
  left_join(counties_data %>% select(county_fips_code, state_name), by = "county_fips_code")

averaged_unemployment_state <- averaged_unemployment %>%
  group_by(state_name) %>%
  summarise(mean_unemployment = mean(mean_unr_16, na.rm = TRUE))


merged_data <- inner_join(averaged_unemployment_state, average_childcare_costs_state, by = "state_name")

# Create the correlation graph
ggplot(merged_data, aes(x = mean_unemployment, y = avg_childcare_costs_state)) +
  geom_jitter(alpha = 0.5, width = 0.2, height = 0.2) +  # Adjust alpha for transparency
  # geom_smooth(method = "lm", color = "blue") +
  labs(x = "Average Unemployment Rate (%)", 
       y = "Average Childcare Costs (USD)", 
       title = "Relationship between Unemployment Rate and Childcare Costs") +
  theme_minimal()

```

## CONCLUSION

:::incremental
- Gender and Regional Unemployment Disparities: Highlighted notable differences in unemployment by gender and region, underscoring diverse economic challenges.
- Link Between Unemployment and Poverty: Showed a strong relationship between unemployment and poverty, stressing the need for focused support
- Childcare Costs Affecting Family Poverty: Identified regions where high childcare costs contribute significantly to family poverty.
- Directions for Future Research and Policies: Suggested using predictive models and expanding research to better inform policies that support families.

:::

## FUTURE ENHANCEMENTS

:::incremental
- Time Series Analysis: Explore trends and changes in childcare costs, unemployment, and poverty over time to identify patterns or shifts due to economic cycles or policy changes.
- Machine Learning Predictions: Use machine learning to predict future trends in unemployment, poverty levels, and childcare costs, aiding policymakers in decision-making.
- Policy Impact Assessment: Examine the effectiveness of specific policies (like childcare subsidies or tax credits) on reducing unemployment and poverty, identifying successful strategies.
- Additional Socio-economic Variables: Incorporate variables such as education, healthcare access, and housing affordability to provide a comprehensive view of factors affecting family well-being.

:::

## Feeling adventurous?

-   You are welcomed to use the default styling of the slides. In fact, that's what I expect majority of you will do. You will differentiate yourself with the content of your presentation.

-   But some of you might want to play around with slide styling. Some solutions for this can be found at https://quarto.org/docs/presentations/revealjs.
